<element name="xf-input">
    <template>
        <!-- the context for pathes is the original xforms element -->
        <label for="{{@id}}">{{xf:label}}</label>
        <input type="text" placeholder="{{hint}}" />

    </template>
    <script>
        xtag.register('xf-input', {


                lifecycle:{
                    created: function(){
                        console.log("input created",this);
                        this.xtag.input = this.querySelector("input");
                    },

                    inserted: function(){
                        console.log("input inserted");

                        // fired each time a component
                        // is inserted into the DOM
                    },

                    removed: function(){
                        console.log("removed");
                        // fired each time an element
                        // is removed from DOM
                    },
                    attributeChanged: function(){
                        console.log("attributeChanged  ");
                        // fired when attributes are set
                    }
                },
                events: {
/*                    'change:delegate(input)': function(e){
                        console.log("change:delegate(input): this.value  ",this.value);

                        console.log("this: ",this);
                        console.log("this.xtag: ",this.xtag);

                        this.parentNode.sendValueToServer(this.value);
                    },
                    'keyup:delegate(input)': function(e){
                        // this.xtag.sendValueToServer(this.value);
                    }
*/
                },
                accessors: {
                    valid: {
                        attribute: {}
                    },
                    enabled: {
                        attribute: {}
                    },
                    required: {
                        attribute: {},
                        get: function(){
                            console.warn("TBD: input-string: get required: ", this.xtag.input);

                        },
                        set: function(value){
                            console.log("input-string: set required: ", value);
                            if("true" === value){
                                var att=document.createAttribute("required");
                                att.value = "required";
                                this.xtag.input.setAttributeNode(att);
                            }else  {
                                this.xtag.input.removeAttribute("required");
                            }
                        }
                    },
                    readonly: {
                        attribute: {},
                        get: function(){
                            console.warn("TBD: input-string: get readonly: ", this.xtag.input);

                        },
                        set: function(value){
                            console.log("input-string: set readonly: ", value);
                            if("true" === value){
                                var att=document.createAttribute("readonly");
                                att.value = "readonly";
                                this.xtag.input.setAttributeNode(att);
                            }else  {
                                this.xtag.input.removeAttribute("readonly");
                            }
                        }
                    },

                    value: {
                        attribute: {},
                        get: function(){
                            console.log("input-string: get value: ", this.xtag.input.value);
                            return this.xtag.input.value;
                        },
                        set: function(value){
                            console.log("input-string: set value: ", value);
                            this.xtag.input.value = value;
                        }
                    },
                    incremental: {
                        attribute: {},

                        set: function(value){
                            console.log("input-string: set incremental: ", value, " inc2:", true == value);
                            var self = this;

                            if("true" == value){
                                if(this.evt != undefined){
                                    xtag.removeEvent(this,"change",this.evt);
                                }

                                // TBD: remove event listener
                                this.evt = xtag.addEvent(this, 'keyup:delegate(input)', function(e){
                                    console.log("eventlistener: change:keyup(input): this.value  ",this.value);
                                    self.sendValueToServer(this.value);
                                });


                            }else {
                                if(this.evt != undefined){
                                    xtag.removeEvent(this,"keyup",this.evt);
                                    this.evt = undefined;
                                }
                                this.evt = xtag.addEvent(this, 'change:delegate(input)', function(e){
                                    console.log("eventlistener :change:delegate(input): this.value  ",this.value);
                                    self.sendValueToServer(this.value);
                                });

                            }
                        }
                    }
                },
                methods: {

                    sendValueToServer:function(value){
                        var msg = jQuery.stringifyJSON({
                            targetId:this.parentNode.id,
                            eventType:'changed',
                            value:this.value
                        });
                        document.querySelector("better-atmosphere").pushMsg(msg);

                    },


                    /* Update input-string webcomponent to value from remote server */
                    updateToRemoteState:function(mips){
                        console.debug("input-string: updateToRemoteState mips:",mips, " this: ",this);
                        if(mips.contextInfo.value){
                            // this.xtag.input.value = mips.contextInfo.value;
                            this.value = mips.contextInfo.value;
                        }
                        if(mips.contextInfo.required){
                            // this.xtag.input.value = mips.contextInfo.value;
                            this.required = mips.contextInfo.required;
                        }
                        if(mips.contextInfo.readonly){
                            // this.xtag.input.value = mips.contextInfo.value;
                            this.readonly = mips.contextInfo.readonly;
                        }

                        if(mips.contextInfo.valid){
                            // this.xtag.input.value = mips.contextInfo.value;
                            this.valid = mips.contextInfo.valid;
                        }

                        if(mips.contextInfo.enabled){
                            this.enabled = mips.contextInfo.enabled;
                        }

                        console.debug("input-string: finished updateToRemoteState mips:",mips, " this: ",this);

                    }
                }
            });
    </script>
</element>